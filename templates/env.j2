{#
SPDX-FileCopyrightText: 2023 MASH project contributors
SPDX-FileCopyrightText: 2025 Slavi Pantaleev
SPDX-FileCopyrightText: 2025 Suguru Hirahara

SPDX-License-Identifier: AGPL-3.0-or-later
#}

TZ={{ forgejo_environment_variables_tz }}

# See:
#  - https://forgejo.org/docs/latest/admin/installation-docker/
#  - https://forgejo.org/docs/latest/admin/config-cheat-sheet/
#  - https://codeberg.org/forgejo/forgejo/src/branch/forgejo/custom/conf/app.example.ini

USER_UID={{ forgejo_uid }}
USER_GID={{ forgejo_gid }}

FORGEJO__server__ROOT_URL={{ forgejo_config_root_url }}

FORGEJO__server__SSH_PORT={{ forgejo_container_ssh_port }}
FORGEJO__server__SSH_LISTEN_PORT={{ forgejo_config_server_ssh_listen_port }}

FORGEJO__server__MINIMUM_KEY_SIZE_CHECK={{ forgejo_config_server_minimum_key_size_check | to_json }}

{% if forgejo_database_type == 'mysql' %}
FORGEJO__database__DB_TYPE={{ forgejo_database_type }}
FORGEJO__database__HOST={{ forgejo_database_mysql_hostname }}:{{ forgejo_database_mysql_port }}
FORGEJO__database__USER={{ forgejo_database_mysql_username }}
FORGEJO__database__PASSWD={{ forgejo_database_mysql_password }}
FORGEJO__database__NAME={{ forgejo_database_name }}
{% endif %}
{% if forgejo_database_type == 'postgres' %}
FORGEJO__database__DB_TYPE={{ forgejo_database_type }}
FORGEJO__database__HOST={{ forgejo_database_postgres_hostname }}:{{ forgejo_database_postgres_port }}
FORGEJO__database__USER={{ forgejo_database_postgres_username }}
FORGEJO__database__PASSWD={{ forgejo_database_postgres_password }}
FORGEJO__database__NAME={{ forgejo_database_name }}
{% endif %}

{% if forgejo_config_run_user %}
FORGEJO____RUN_USER={{ forgejo_config_run_user }}
{% endif %}

FORGEJO__service__ENABLE_NOTIFY_MAIL={{ forgejo_config_service_enable_notify_email | to_json }}

FORGEJO__service__DISABLE_REGISTRATION={{ forgejo_config_service_disable_registration }}
FORGEJO__service__REGISTER_MANUAL_CONFIRM={{ forgejo_config_service_register_manual_confirm }}

FORGEJO__service__ENABLE_OPENID_SIGNIN={{ forgejo_config_service_enable_openid_signin }}
FORGEJO__service__ENABLE_OPENID_SIGNUP={{ forgejo_config_service_enable_openid_signup }}

FORGEJO__oauth2_client__ENABLE_AUTO_REGISTRATION={{ forgejo_config_oauth2_client_enable_auto_registration }}

{% if forgejo_config_mailer_enabled %}
FORGEJO__mailer__ENABLED=true
FORGEJO__mailer__FROM={{ forgejo_config_mailer_from }}
FORGEJO__mailer__PROTOCOL={{ forgejo_config_mailer_protocol }}
FORGEJO__mailer__SMTP_ADDR={{ forgejo_config_mailer_smtp_addr }}
FORGEJO__mailer__SMTP_PORT={{ forgejo_config_mailer_smtp_port }}
FORGEJO__mailer__USER={{ forgejo_config_mailer_user }}
FORGEJO__mailer__PASSWD={{ forgejo_config_mailer_passwd }}
{% endif %}

FORGEJO__cache__ADAPTER={{ forgejo_config_cache_adapter }}

{% if forgejo_config_cache_adapter == 'memory' %}
{% elif forgejo_config_cache_adapter == 'redis' %}
FORGEJO__cache__HOST=redis://{{ forgejo_redis_username }}:{{ forgejo_redis_password }}@{{ forgejo_redis_hostname }}:{{ forgejo_redis_port }}/{{ forgejo_redis_database }}?pool_size=100&idle_timeout=180s
{% elif forgejo_config_cache_adapter == 'redis-cluster' %}
FORGEJO__cache__HOST=redis+cluster://{{ forgejo_redis_username }}:{{ forgejo_redis_password }}@{{ forgejo_redis_hostname }}:{{ forgejo_redis_port }}/{{ forgejo_redis_database }}?pool_size=100&idle_timeout=180s
{% else %}
FORGEJO__cache__HOST={{ forgejo_config_cache_host }}
{% endif %}

{{ forgejo_environment_variables_additional_variables }}
